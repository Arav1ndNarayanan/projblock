<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>DocBlock</title>
  <!-- Mobile Specific Metas -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- Font-->
  <link rel="stylesheet" type="text/css" href="css/montserrat-font.css">
  <link rel="stylesheet" type="text/css" href="fonts/material-design-iconic-font/css/material-design-iconic-font.min.css">
  <!-- Main Style Css -->
    <link rel="stylesheet" href="css/style.css"/>
    <script src="web3.js"></script>
    <script src="jquery.min.js"></script>
    <script src="jquery-migrate-1.4.1.min.js"></script>
</head>
<body class="form-v10">
  <div class="page-content">
    <div class="form-v10-content">
      <form class="form-detail" action="#" method="post" id="myform">
        <div class="form-left">
          <h2>DocBlock</h2>
          <div class="form-row">
            <select name="title" id="vt">
                <option class="option" value="title">Vehicle Type</option>
                <option class="option" value="Two wheele">Two wheeler</option>
                <option class="option" value="Four wheeler">Four wheeler</option>
                <option class="option" value="Heavy Vehcle">Heavy Vehcle</option>
            </select>
            <span class="select-btn">
                <i class="zmdi zmdi-chevron-down"></i>
            </span>
          </div>
          <div class="form-group">
            <div class="form-row form-row-1">
              <input type="text" name="first_name" id="fn" class="input-text" placeholder="Owners First Name" required>
            </div>
            <div class="form-row form-row-2">
              <input type="text" name="last_name" id="ln" class="input-text" placeholder="Owners Last Name" required>
            </div>
          </div>
          <div class="form-group">
            <div class="form-row form-row-1">
              <input type="text" name="regno" id="rn" class="input-text" placeholder="Registration Number" required>
            </div>
          </div>
          <div class="form-row">
            <select name="company" id="cmp">
                <option value="position">company</option>
                <option value="director">Honda</option>
                <option value="manager">TVS</option>
                <option value="employee">HERO</option>
            </select>
            <span class="select-btn">
                <i class="zmdi zmdi-chevron-down"></i>
            </span>
          </div>
              <div class="form-row">
            <select name="model" id="mod">
                <option value="position">model name</option>
                <option value="director">Shine</option>
                <option value="manager">Livo</option>
                <option value="employee">Unicorn</option>
            </select>
            <span class="select-btn">
                <i class="zmdi zmdi-chevron-down"></i>
            </span>
          </div>
          <div class="form-row">
            <input type="text" name="company" class="company" id="company" placeholder="Company" required>
          </div>
          <div class="form-group">
            <div class="form-row form-row-3">
              <input type="text" name="chase nmber" class="business" id="cn" placeholder="chase number" required>
            </div>
            <div class="form-row form-row-4">
              <select name="ownership">
                  <option value="ownership">ownership</option>
                  <option value="first party">first party</option>
                  <option value="second party">second party</option>
                  <option value="third party">third party</option>
              </select>
              <span class="select-btn">
                  <i class="zmdi zmdi-chevron-down"></i>
              </span>
            </div>
          </div>
        </div>
        <div class="form-right">
          <h2>Insurence details</h2>
           <div class="form-row">
            <input type="text" name="am" class="insurence amount" id="amt" placeholder="insurence amount" required>
          </div>
          <div class="form-row">
            <input type="text" name="dtaea" class="date of issue" id="doi" placeholder="date of issue" required>
          </div>
      <div class="form-row">
            <input type="text" name="dtaeae" class="date of expiry" id="doe" placeholder="date of expiry" required>
          </div>
          <div class="form-group">
            <div class="form-row form-row-1">
              <input type="text" name="code" class="code" id="code" placeholder="Code +" required>
            </div>
            <div class="form-row form-row-2">
              <input type="text" name="phone" class="phone" id="ph" placeholder="Phone Number" required>
            </div>
          </div>
          <div class="form-row">
            <input type="text" name="your_email" id="mail" class="input-text" required pattern="[^@]+@[^@]+.[a-zA-Z]{2,6}" placeholder="Your Email">
          </div> 
         
          <div class="form-row-last">
            <input type="button" id="do" name="register"  class="register" value="Register ">
              <input type="button" id="show" name="view"  class="register" value="view " style="display:none;">
          </div> 
        </div>
      </form>
    </div>
  </div>
      <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
  <!--  <script src="js/bootstrap.min.js"></script>
    <script src="js/web3.min.js"></script>
    <script src="js/truffle-contract.js"></script>
    <script src="js/app.js"></script> -->
</body><!-- This templates was made by Colorlib (https://colorlib.com) -->
<script>
 var contract
$(document).ready(()=>{

const provider = new Web3.providers.HttpProvider(
'http://127.0.0.1:8545',
);  
const web3 = new Web3(provider); 
  // var web3 = new Web3(web3.currentProvider)
  var abi = [
  {
    "constant": false,
    "inputs": [
      {
        "name": "fn",
        "type": "string"
      },
      {
        "name": "lame",
        "type": "string"
      },
      {
        "name": "rn",
        "type": "string"
      },
      {
        "name": "mod",
        "type": "string"
      },
      {
        "name": "chno",
        "type": "string"
      },
      {
        "name": "doi",
        "type": "string"
      },
      {
        "name": "doe",
        "type": "string"
      }
    ],
    "name": "insu_setname",
    "outputs": [],
    "payable": false,
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [],
    "name": "insu_getname",
    "outputs": [
      {
        "name": "",
        "type": "string"
      },
      {
        "name": "",
        "type": "string"
      },
      {
        "name": "",
        "type": "string"
      },
      {
        "name": "",
        "type": "string"
      },
      {
        "name": "",
        "type": "string"
      },
      {
        "name": "",
        "type": "string"
      },
      {
        "name": "",
        "type": "string"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "payable": false,
    "stateMutability": "nonpayable",
    "type": "constructor"
  }
]
  var i =0
    var address = "0x1816b25C4F8A0F32676d4617fB80db043cf2b099"
    contract = new web3.eth.Contract(abi,address)
    console.log(contract)

    accounts = web3.eth.getAccounts().then((res)=>{return res[2]})
    console.log(accounts)
    //var acc = Promise.resolve(accounts)
    acc1 =   accounts.then((res,err)=>{
     alert(res)
     hsh=res
    // document.getElementById('show').style.visibility = 'hidden';
     document.getElementById("show").value = hsh;

    })
    /*contract.methods.getname().call().then(function(res){
        $('#fnam').html(res)
    })
*/
})
$('#do').click(function(){
  var x = document.getElementById("show").value;
alert("success:"+x)
      // var acc = "02EB4F057e2d526FD7c9fe29D08eF6ac0BEa00D4"
     const ln = $('#ln').val()
    const fn = $('#fn').val()
    const regn = $('#rn').val()
       const model = $('#mod').val()
    
    const chase = $('#cn').val()
    const doi = $('#doi').val()
    const doe = $('#doe').val()
    
   
    
        contract.methods.insu_setname(fn,ln,regn,model,chase,doi,doe).send({from:x,gas:3000000}).on("transactionHash", function(tHash){
       document.getElementById("show").value = tHash
       //return(tHash)
       var y=document.getElementById("show").value;
       alert(y)
       var queryString = "?para1=" + y + "&para2=" + y;
        window.location.href = "qr.html" + queryString;
    })
    //console.log("hash :"+)
    
})
</script>
</html>